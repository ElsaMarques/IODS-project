---
title: "Chapter5"
author: "Elsa Marques"
date: "11/29/2017"
output: html_document
---

# Dimensionality reduction techniques

*This chapter will teach you how to reduce a huge amount of variables (data dimensions) to a smaller and more relevant variables in order to make it easier to visualize and compare different data populations. The key method to reduce the multidimensional data is the principal component analysis (PCA). The multiple correspondence analysis (MCA) and other correspondece analysis (CA) are also covered in this chapter.*

## *About this week working data set "Human"*

  > The 'human' dataset originates from the United Nations Development Programme. See their [data page](http://hdr.undp.org/en/content/human-development-index-hdi) for more information. For a nice overview see also the calculating the human development indices [pdf](http://hdr.undp.org/sites/default/files/hdr2015_technical_notes.pdf).
This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

## **Load the "human_" data into R.**

```{r, echo=FALSE}
library(dplyr)
#Load the data set used in the data wrangling section (from your local drive)
human_ <- read.table("human_.csv", row.names = 1 , header = TRUE, sep = ",")
head(human_, n = 10)
```


### **Explore the structure and the dimensions of the data and describe the dataset briefly.**

```{r, echo=FALSE}
library(dplyr)
str(human_)
dim(human_)
```

 - The brief overview on this data shows that the data "human_" created during the data wrangling exercise comprises 155 observations spread into 8 variables. 
 
 - These observations are selected from a bigger data set of observations included to calculate the human development indices; Different index are used for this purpose, inclding two we merged in the data wrangling exercise (Human Development Index (HDI) & Gender Development Index (GDI))
 
 - Selected factors were:
    - Edu2.FM  = % of population with secondary education (Female and Male); 
    - Labo.FM  = Female and male labour force participation rates;
    - Edu.Exp = Education expectancy;
    - GNI = Gross national income per capita; 
    - Life.Exp = Life expectancy;
    - Mat.Mor = Maternal mortality rate (deaths /100,000 live births);
    - Ado.Birth = Adolescent birth rate; 
    - Parli.F = % of seats taken by female in the parliament
 
## **Show a graphical overview of the data and show summaries of the variables in the data.** 

```{r, echo=FALSE}
library(GGally)
#Visual obervation of the "human_" variables

# Summarize the "human_" variables
summary(human_)
```

 - 
 
 
```{r, echo=FALSE}
library(corrplot)
# calculate the correlation matrix and round it
cor_matrix <-cor(human_) %>% round(digits = 2)

# print the correlation matrix
cor_matrix

#visualize it with corrplot
human_ %>% corrplot()
```

- Describe and interpret the outputs, commenting on the distributions of the variables and the relationships between them. (0-2 points)

## **Perform principal component analysis (PCA) on the not standardized human data.**
```{r, echo = FALSE}
# perform principal component analysis (with the SVD method)
pca_human <- prcomp(human_)
pca_human

```


### **Show the variability captured by the principal components.** 

### **Draw a biplot displaying the observations by the first two principal components (PC1 coordinate in x-axis, PC2 coordinate in y-axis), along with arrows representing the original variables.** 

```{r, echo = FALSE}
# create and print out a summary of pca_human
s <- summary(pca_human)
s

# rounded percentages of variance captured by each PC
pca_pr <- round(100*s$importance[2, ], digits = 1)
pca_pr

# create object pc_lab to be used as axis labels
pc_lab <- paste0(names(pca_pr), " (", pca_pr, "%)")
pc_lab

# draw a biplot of the principal component representation and the original variables
biplot(pca_human, choices = 1:2, cex = c(0.2,1), col = c("grey40", "deepblue"))
```

(0-2 points)

## **Standardize the variables in the human data and repeat the above analysis.** 
```{r, echo = FALSE}
# standardize the variables
human_std <- scale(human_)

# print out summaries of the standardized variables
summary(human_std)

# perform principal component analysis (with the SVD method)
pca_human <- prcomp(human_std)

# draw a biplot of the principal component representation and the original variables
biplot(pca_human, choices = 1:2, cex = c(0.2,1), col = c("grey40", "deeppink2"))
```

Interpret the results of both analysis (with and without standardizing). Are the results different? Why or why not? 

Include captions in you plots where you describe the results by using not just your variable names, but the actual phenomenons they relate to. 

(0-4 points)

## **Personal interpretations of the first two principal component dimensions based on the biplot drawn after PCA on the standardized human data.** 


(0-2 points)

## **Load the tea dataset from the package Factominer.**

```{r}
# Load the tea dataset and packages FactoMineR
library(FactoMineR)
data("tea")
```


### **Explore the data briefly: look at the structure and the dimensions of the data and visualize it.** 

```{r, echo = FALSE}
# structure and dimensions of the data
str(tea)
dim(tea)
```
 - The data is formed by a total of 36 variables with 300 observations. 
 
 - Tea data contains information about when the enquired people drink tea, where they drink tea, how they drink the tea (either the format of the tea they use ("how"), or with some addictives ("How")), what's the price range of the consumed tea, the kind and purpose of the tea they drink, age and sex of the enquired people.

#### To better explode Tea data, I decided to start by focusing on the type of Tea (purpose of the Tea in this case) the enquired people consume. 
```{r, echo=FALSE}
#Let's start to focus on the type of tea enquires answered to consume
keep_columns <- c("escape.exoticism", "spirituality", "healthy", "diuretic", "friendliness", "iron.absorption", "feminine", "sophisticated", "slimming", "exciting", "relaxing", "effect.on.health")

# select the 'keep_columns' to create a new dataset
tea_type <- select(tea, one_of(keep_columns))

# look at the summaries and structure of the data
summary(tea_type)
str(tea_type)

# visualize the dataset
gather(tea_type) %>% ggplot(aes(value)) + facet_wrap("key", scales = "free") + geom_bar() + theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) 
```



#### Since previous approach didn't unreavel nothing that interesting, I decided to re- focus on the how, when and where people consume Tea together with gender differences of the enquired people. 
```{r, echo = FALSE}
#Lets check another set of variables included in the tea data set
keep_columns <- c("Tea", "How", "how", "sugar", "where", "lunch", "price", "sex")

# select the 'keep_columns' to create a new dataset
tea_time <- dplyr::select(tea, one_of(keep_columns))

# look at the summaries and structure of the data
summary(tea_time)
str(tea_time)

# visualize the dataset
gather(tea_time) %>% ggplot(aes(value)) + facet_wrap("key", scales = "free") + geom_bar() + theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 6)) 
```

- Starting form the most dramatic differences towards the milder ones:
  - Majority of the enquired people don't drink tea at lunch time; 
  - Majority of the enquired people drink Tea alone, not mixing lemon, milk or any other additive. 
  - Earl grey is the most consumed tea amongst the enquired people, followed with what seems significantly less amount of people consuming black and green tea. 
  - Similar ratios can be observed from where the tea is bought. Majority buys it on chain stores, with seemingly less amount of people buying at a chain store + tea shop and even less at dedicated tea shops. 
  - Most people consume tea that is provided in tea bags and less dramatic differences are noted to the ones that consume tea bags + unpackaged or just unpackaged. 
  - There is really not really much differences in the prices of the consumed teas, being the majority of the consumed tea of a variable price or branded price.
  - From the enquired people, it seems it's almost 50/50 for the consuption of tea with or without  sugar 
  - It seems there was only slighly more females answering to the tea questionaire. 


### **Then do Multiple Correspondence Analysis on the tea data (or to a certain columns of the data, itâ€™s up to you).** 

```{r}
# multiple correspondence analysis
mca <- MCA(tea_time, graph = FALSE)

# summary of the model
summary(mca)
```

- After performing the multiple correspondence analysis (MCA) we identified three dimensions that can be used to categorize the Tea data subset tea_time. The categorical variables table shows you 


### **Drawing of the variable biplot of the previous analysis.**

```{r, echo=FALSE}
# visualize MCA
mca <- MCA(tea_time, graph = FALSE)
plot(mca, invisible=c("none"), habillage = "quali")
```


 - The typical MCA bipolot shows the original classes of the discrete variables on the same "map". This allows us to check the data distributions of the different variables, revealing the connections (correspondences) between different things that would be quite impossible to see from the corresponding cross table. The plot including all the data seems extremelly busy and difficult to verify the correlations between the variables 

- The axis legends inlcude the name of the dimensions and their respective & of variance (calculated and show in the previous table)

### **Exploring other plotting options for better visualization of the variables relationships.** 

```{r, echo = FALSE}
#Exclude from the plot the data that already in the previous analysis seemingly didn't had much variation
plot(mca, invisible=c("ind"), habillage = "quali")
```
 
 - Now upong removal of the individuals in the plot you can better verify how the variables better relate with one or the other dimension. 
 - In this case you can check how the sugar / no sugar variables equally related to both dimensions , while the Tea (green / black / earl grey) & how (tea bag / tea bag + unpackaged / unpackaged) seem to better relate with the dmension 2.


